@model IEnumerable<OfficeBooking.ViewModels.AdminReservationRowViewModel>

@{
    ViewData["Title"] = "All Reservations";
}

<partial name="_PageHeader" model='("Reservations (Admin)", "View all reservations and cancel them with a reason.")' />

<div class="card bg-light mb-4 mt-3">
    <div class="card-body py-2">
        <form method="get" class="row align-items-center g-3">
            <div class="col-auto">
                <span class="fw-bold text-muted">Filters:</span>
            </div>
            <div class="col-auto">
                <div class="form-check pt-1">
                    <input class="form-check-input" type="checkbox" name="activeOnly" value="true" id="activeOnly"
                           @(Context.Request.Query["activeOnly"] == "true" ? "checked" : "") />
                    <label class="form-check-label" for="activeOnly">
                        Show only active reservations
                    </label>
                </div>
            </div>
            <div class="col-auto">
                <button class="btn btn-sm btn-primary" type="submit">Apply</button>
                <a asp-action="Index" class="btn btn-sm btn-outline-secondary ms-2">Clear</a>
            </div>
        </form>
    </div>
</div>

@if (!Model.Any())
{
    <div class="alert alert-info">No reservations match the criteria.</div>
}
else
{
    <div class="table-responsive">
        <table class="table table-sm table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Room</th>
                    <th>Title</th>
                    <th>When (From - To)</th>
                    <th>Who</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var r in Model)
                {
                    <tr>
                        <td>@r.RoomName</td>
                        <td>
                            <span class="d-block text-truncate" style="max-width: 150px;" title="@r.Title">
                                @r.Title
                            </span>
                        </td>
                        <td class="small">
                            <div class="text-nowrap">@r.Start.ToString("yyyy-MM-dd HH:mm")</div>
                            <div class="text-nowrap text-muted">@r.End.ToString("yyyy-MM-dd HH:mm")</div>
                        </td>
                        <td>
                            <small class="d-block">@r.UserEmail</small>
                            <small class="text-muted">(@r.AttendeesCount people)</small>
                        </td>
                        <td>
                            @if (r.IsCancelled)
                            {
                                <span class="badge bg-secondary">Cancelled</span>
                            }
                            else
                            {

                                <span class="badge bg-success">Active</span>
                            }
                        </td>
                        <td>
                            @if (!r.IsCancelled)
                            {
                                <a class="btn btn-sm btn-warning"
                                   asp-controller="AdminReservations"
                                   asp-action="Cancel"
                                   asp-route-id="@r.Id">
                                    Cancel
                                </a>
                            }
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
